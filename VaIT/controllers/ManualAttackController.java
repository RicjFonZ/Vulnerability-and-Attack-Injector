package controllers;

import javafx.fxml.FXML;
import javafx.fxml.Initializable;
import javafx.scene.control.Button;
import javafx.scene.control.TextArea;
import utilities.HandleFiles;

import java.net.URL;
import java.util.ResourceBundle;

public class ManualAttackController implements Initializable {

    @FXML TextArea responseTextArea;
    @FXML TextArea htmlTextArea;
    @FXML Button exportResponseBt;
    @FXML Button exportHtmlBt;
    @FXML Button clearResponseBt;
    @FXML Button clearHtmlBt;
    @FXML Button previewHtmlBt;

    private final HandleFiles handleFiles = new HandleFiles();

    @Override
    public void initialize(final URL location, final ResourceBundle resources) {

        // Listener for all changes on response and Http text area to control visibility of buttons
        addListenerTextAreas();

        //Export Response
        exportResponse();

        // Export Html
        exportHtml();

        // Clear TextAreas related to response and Http
        clearTextAreaButtons();

    }

    private void exportResponse() {

        exportResponseBt.setOnAction(event -> handleFiles.saveFile(
                "Text File",
                "*.txt",
                responseTextArea,
                "",
                "AttackResponse"
        ));
    }

    private void exportHtml() {

        exportHtmlBt.setOnAction(event -> handleFiles.saveFile(
                "HTML File",
                "*.html",
                htmlTextArea,
                "",
                "AttackHTML"));
    }

    private void addListenerTextAreas() {
        responseTextArea.textProperty().addListener((observable, oldValue, newValue) -> {
            if (newValue.length() != 0){
                changeStateResponseButtons(false);
            }else {
                changeStateResponseButtons(true);
            }
        });

        htmlTextArea.textProperty().addListener((observable, oldValue, newValue) -> {
            if (newValue.length() != 0){
                changeStateHttpButtons(false);
            }else {
                changeStateHttpButtons(true);
            }
        });
    }

    private void changeStateResponseButtons(boolean state) {
        exportResponseBt.setDisable(state);
        clearResponseBt.setDisable(state);
    }

    private void changeStateHttpButtons(boolean state) {
        exportHtmlBt.setDisable(state);
        clearHtmlBt.setDisable(state);
        previewHtmlBt.setDisable(state);
    }

    private void clearTextAreaButtons() {

        clearResponseBt.setOnAction(event -> responseTextArea.clear());
        clearHtmlBt.setOnAction(event -> htmlTextArea.clear());
    }
}
