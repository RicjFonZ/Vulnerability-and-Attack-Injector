package tools.controllers;

import datamodel.RegexTable;
import javafx.collections.FXCollections;
import javafx.collections.ObservableList;

import javafx.scene.control.Button;
import javafx.scene.control.CheckBox;
import javafx.scene.control.TableColumn;
import javafx.scene.control.TableView;
import javafx.scene.control.TextField;
import javafx.scene.control.Label;
import utilities.filewatcher.FileWatcherController;
import utilities.HandleFiles;
import javafx.fxml.FXML;
import javafx.fxml.FXMLLoader;
import javafx.fxml.Initializable;
import javafx.scene.Parent;
import javafx.scene.Scene;
import javafx.stage.Stage;

import javax.swing.JTextArea;
import javax.swing.text.BadLocationException;
import java.io.File;
import java.io.FileNotFoundException;
import java.net.URL;
import java.util.ResourceBundle;
import java.util.logging.Logger;
import java.util.regex.Matcher;
import java.util.regex.Pattern;

public class RegexToolController implements Initializable {

    @FXML private TableView<RegexTable> regexTable;
    @FXML private TableColumn<RegexTable, String> startColumn;
    @FXML private TableColumn<RegexTable, String> endColumn;
    @FXML private TableColumn<RegexTable, String> lineColumn;
    @FXML private TableColumn<RegexTable, String> columnColumn;
    @FXML private TableColumn<RegexTable, String> resultColumn;

    @FXML private CheckBox caseSensitiveCheckBox;
    @FXML private Button analysingButton;
    @FXML private Button openFileButton;
    @FXML private Button watchFileButton;
    @FXML private Button exportButton;
    @FXML private TextField regexTextField;
    @FXML private TextField fileLocationTextField;
    @FXML private Label statusLabel;

    private final HandleFiles handleFiles = new HandleFiles();
    private Logger log = Logger.getLogger(RegexToolController.class.getName());

    private ObservableList<RegexTable> regexData = FXCollections.observableArrayList();

    private final static String DEFAULT_REGEX = "\\$?\\b.*\\b\\s*=\\s*intval\\s*(\\([^\\)\\(]*(\\([^\\)\\(]*\\))?\\)){1}\\s*;";

    //The use of JTextArea is deprecated, and only is used to get the line based on given offset
    private JTextArea jTextArea = new JTextArea();

    private String phpTest = "<?php\n" +
            "//These lines of code should be at the beginnig of every php file\n" +
            "require_once(\"global.php\");  // Define database constants\n" +
            "require_once(\"library.php\"); //function libraries\n" +
            "require_once(\"session.php\"); //session parameters\n" +
            "//The following line must be only in php files that sholud be connected (after the login.php)\n" +
            "require_once(\"connect.php\"); //if the user is not connected then he is sent to the index.php page\n" +
            "?>\n" +
            "\n" +
            "<html>\n" +
            "<!--\n" +
            "The following line should be at the beginnig of every php file in order to accept Portugues chars\n" +
            "-->\n" +
            "<meta http-equiv=\"Content-Type\" content=\"text/html; charset=utf-8\" />\n" +
            "<head>\n" +
            "<link rel=\"shortcut icon\" href=\"favicon.ico\">\n" +
            "<title>PhD edit paper</title>\n" +
            "</head>\n" +
            "<body bgcolor=\"#ffffff\">\n" +
            "<?php\n" +
            "if ($_SESSION['profile']==0)\n" +
            "{\n" +
            "\t//********************************************************************************************************\n" +
            "\t// Delete Papers\n" +
            "\t//********************************************************************************************************\n" +
            "\tif(isset($_GET['submit_papers_table_id']) && isset($_GET['submit_papers_table']) && $_GET['submit_papers_table']==Delete)\n" +
            "\t{\n" +
            "\t\t$submit_papers_table_id=intval($_GET['submit_papers_table_id']);\n" +
            "\t\tif ($_SESSION['profile']==0) //only users with profile=0 can delete papers\n" +
            "\t\t{\n" +
            "\t\t\t$conn = phd_connect();\n" +
            "\t\t\tif(isset($_GET['verify']) && $_GET['verify']==true)\n" +
            "\t\t\t{\n" +
            "\t\t\t\t// execute the query, grab the result in $result\n" +
            "\t\t\t\t$sql_text=sprintf(\"delete from authors where paper=%d\",$submit_papers_table_id);\n" +
            "\t\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\t\n" +
            "\n" +
            "\t\t\t\t$sql_text=\"delete from papers where id=\".$submit_papers_table_id;\n" +
            "\t\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\t\n" +
            "\t\t\t\t$sql_text=\"commit\";\n" +
            "\t\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\t\n" +
            "\t\t\t//\toci_commit($conn);\n" +
            "\t\t\t\techo '<meta http-equiv=\"REFRESH\" content=\"0; url=show_papers.php\">'; //go to the show_papers.php page after deleting the paper\n" +
            "\t\t\t}\n" +
            "\t\t\telse\n" +
            "\t\t\t{\n" +
            "\t\t\t\t// execute the MySQL query, grab the result in $result\n" +
            "\t\t\t\t$sql_text=sprintf(\"select title from papers where id=%d\",$_GET['submit_papers_table_id']);\n" +
            "\t\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\t\n" +
            "\t\t\t\t$row=mysql_fetch_row($result);\n" +
            "\n" +
            "\t\t\t\techo \"You are about to delete the following paper: <br>\\n\";\n" +
            "\t\t\t\techo \"<b>\".htmlspecialchars($_GET['submit_papers_table_id'],ENT_QUOTES).\" <-> \\\"\".htmlspecialchars($row[0]).\"\\\"</b><br><br>\\n\";\n" +
            "\t\t\t\techo \"Click here to: <a href=\".htmlspecialchars($_SERVER['PHP_SELF']).\"?submit_papers_table_id=\".urlencode(htmlspecialchars($_GET['submit_papers_table_id'],ENT_QUOTES)).\"&submit_papers_table=Delete&verify=true>delete paper</a><br><br>\\n\";\n" +
            "\t\t\t\techo \"Click here to: <a href='javascript:history.back()'>go back</a>\\n\";\n" +
            "\t\t\t}\n" +
            "\t\t\tmysql_close($conn);\n" +
            "\t\t}\n" +
            "\t\texit; // does not execute more code\n" +
            "\t}\n" +
            "\techo \"<p align=center><b>Hello \".htmlspecialchars($_SESSION['user'],ENT_QUOTES).\"</b></p>\\n\";\n" +
            "\techo \"<a href=\\\"logout.php\\\">Log out</a><br>\\n\";\n" +
            "\techo \"<a href=\\\"index.php\\\">home page</a><br>\\n\";\n" +
            "\techo \"<a href=\\\"insert_paper.php\\\">Insert paper</a><br>\";\n" +
            "\techo \"<a href=\\\"show_papers.php\\\">Show papers</a><br>\";\n" +
            "\techo \"<a href='javascript:history.back()'>Back</a>\\n\";\n" +
            "\n" +
            "\t//********************************************************************************************************\n" +
            "\t// Update Papers\n" +
            "\t//********************************************************************************************************\n" +
            "\tif (isset($_POST['submit_papers_row']) && $_POST['submit_papers_row']=='Update')\n" +
            "\t{\n" +
            "\t\tif ($_SESSION['profile']==0) //only users with profile=0 can update papers\n" +
            "\t\t{\n" +
            "\t\t\t$conn = phd_connect();\n" +
            "\n" +
            "\t\t\t$year=intval($_POST['year']);\n" +
            "\t\t\t$relevance=intval($_POST['relevance']);\n" +
            "\t\t\t$area=intval($_POST['area']);\n" +
            "\t\t\t$id=intval($_POST['id']);\n" +
            "\n" +
            "\t\t\t// execute the MySQL query, grab the result in $result\n" +
            "\t\t\t$sql_text=sprintf(\"update papers set title='%s', link='%s', conference='%s',\n" +
            "\t\t\tyear=%d, resume_por='%s', resume_eng='%s', relevance=%d, area =%d, type ='%s' where id=%d\",\n" +
            "\t\t\taddslashes($_POST['title']),addslashes($_POST['link']),addslashes($_POST['conference']),$year,\n" +
            "\t\t\taddslashes($_POST['resume_por']),addslashes($_POST['resume_eng']),$relevance,$area,addslashes($_POST['type']),$id);\n" +
            "\n" +
            "\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\n" +
            "\t\t\t$sql_text=\"commit\";\n" +
            "\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\n" +
            "\t\t//\toci_commit($conn);\n" +
            "\t\t\tmysql_close($conn);\n" +
            "\t\t}\n" +
            "\t\telse\n" +
            "\t\t{\n" +
            "\t\t\techo \"<br><p align=center><b>Sorry, but you are not alowed to edit papers</b></p><br>\\n\";\n" +
            "\t\t}\n" +
            "\t}\n" +
            "\t//********************************************************************************************************\n" +
            "\t// Insert Papers\n" +
            "\t//********************************************************************************************************\n" +
            "\tif(isset($_POST['submit_papers_table']) && $_POST['submit_papers_table']=='Insert')\n" +
            "\t{\n" +
            "\t\techo \"<br><p align=center><b>Insert Paper</b></p><br>\\n\";\n" +
            "\t\t$conn = phd_connect();\n" +
            "\n" +
            "\t\t$year=intval($_POST['year']);\n" +
            "\t\t$relevance=intval($_POST['relevance']);\n" +
            "\t\t$area=intval($_POST['area']);\n" +
            "\t\t// the next select is to do not let insert two equal rows with the same paper information\n" +
            "\t\t$sql_text=sprintf(\"select count(*) from papers where title = '%s' and link = '%s'\n" +
            "\t\tand conference ='%s' and year =%s and resume_por ='%s' and resume_eng = '%s'\n" +
            "\t\tand relevance =%d and area =%d and type= '%s'\",\n" +
            "\t\taddslashes($_POST['title']),addslashes($_POST['link']),addslashes($_POST['conference']),$year,addslashes($_POST['resume_por']),\n" +
            "\t\taddslashes($_POST['resume_eng']),$relevance,$area,addslashes($_POST['type']));\n" +
            "\n" +
            "\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\n" +
            "\t\t$row=mysql_fetch_row($result);\n" +
            "\n" +
            "\t\t//get number of results and do action\n" +
            "\t\tif ($row[0] < 1){\n" +
            "\t\t\t// execute the query, grab the result in $result\n" +
            "\t\t\t$sql_text=sprintf(\"insert into papers (title,link,conference,year,resume_por,resume_eng,relevance,area,type)\n" +
            "\t\t\tvalues ('%s','%s','%s',%s,'%s','%s',%d,%d,'%s') \",\n" +
            "\t\t\taddslashes($_POST['title']),addslashes($_POST['link']),addslashes($_POST['conference']),$year,addslashes($_POST['resume_por']),\n" +
            "\t\t\taddslashes($_POST['resume_eng']),$relevance,$area,addslashes($_POST['type']));\n" +
            "\n" +
            "\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\n" +
            "\n" +
            "\t\t\t$string = $_POST['authors'];\n" +
            "\t\t\t$tokens = explode(';', $string);\n" +
            "\t\t\t\n" +
            "\t\t\t\n" +
            "\t\t\t\n" +
            "\t\t\t\n" +
            "\t\t\t$papers_id=mysql_insert_id();\n" +
            "\n" +
            "\t\t\tforeach($tokens as $tokens)\n" +
            "\t\t\t{\n" +
            "\t\t\t\t$tokens=trim(ereg_replace(' {2,}', ' ', $tokens)); //to remove extra spaces\n" +
            "\t\t\t\t// execute the query, grab the result in $result\n" +
            "\t\t\t\t$sql_text=sprintf(\"insert into authors (paper,name) values (%d,'%s')\",$papers_id,addslashes($tokens));\n" +
            "\t\t\t\t\n" +
            "\t\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\t\n" +
            "\t\t\t}\n" +
            "\t\t\t$sql_text=\"commit\";\n" +
            "\t\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\t\n" +
            "\t\t//\toci_commit($conn);\n" +
            "\t\t\t$_GET['submit_papers_table_id']=$papers_id;\n" +
            "\t\t\t$_GET['submit_papers_table']='Edit';\n" +
            "\n" +
            "\t\t\techo \"<br><p align=center><b>Registo inserido com sucesso</b></p><br>\\n\";\n" +
            "\t\t}\n" +
            "\t\tmysql_close($conn);\n" +
            "\t}\n" +
            "\n" +
            "\t//********************************************************************************************************\n" +
            "\t// Edit Paper\n" +
            "\t//********************************************************************************************************\n" +
            "\tif (isset($_GET['submit_papers_table_id']) && isset($_GET['submit_papers_table']) && $_GET['submit_papers_table']==Edit)\n" +
            "\t{\n" +
            "\t\t$submit_papers_table_id=intval($_GET['submit_papers_table_id']);\n" +
            "\t\techo \"<br><p align=center><b>Edit Paper</b></p><br>\\n\";\n" +
            "\t\t$conn = phd_connect();\n" +
            "\n" +
            "\t\t// execute the query, grab the result in $result\n" +
            "\t\t$sql_text=sprintf(\"select papers.id,title,link,conference,\n" +
            "\t\tyear,resume_por,resume_eng,relevance,area,type\n" +
            "\t\tfrom papers\n" +
            "\t\twhere id=%d\",$submit_papers_table_id);\n" +
            "\n" +
            "\t\t$result = mysql_query($sql_text,$conn);\n" +
            "\t\t\n" +
            "\t\t$row=mysql_fetch_row($result);\n" +
            "\n" +
            "\t\techo \"<form action=\".htmlspecialchars($_SERVER['PHP_SELF']).\"?submit_papers_table_id=\".urlencode($_GET['submit_papers_table_id']).\"&submit_papers_table=\".urlencode($_GET['submit_papers_table']).\" method=post>\\n\";\n" +
            "\t\t?>\n" +
            "\t\t<table border='0' cellspacing='0' cellpadding='0' align=center>\n" +
            "\t\t<tr id='cat'>\n" +
            "\t\t<input type ='hidden' name='id' value='<?php echo htmlspecialchars($row[0],ENT_QUOTES); ?>'>\n" +
            "\t\t<input type ='hidden' name='submit_papers_table' value='<?php echo $_GET['submit_papers_table']; ?>'>\n" +
            "\t\t<input type ='hidden' name='submit_papers_table_id' value=<?php echo $submit_papers_table_id?>>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' ><font face='verdana, arial, helvetica' size='2' align='center'>  title\n" +
            "\t\t</font></td> <td bgcolor='#f1f1f1' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<input type ='text' class='bginput' name='title' value='<?php echo htmlspecialchars($row[1],ENT_QUOTES); ?>' size=\"100\" maxlength=\"500\"></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#ffffff' ><font face='verdana, arial, helvetica' size='2' align='center'>  link\n" +
            "\t\t</font></td> <td bgcolor='#ffffff' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<input type ='text' class='bginput' name='link' value='<?php echo htmlspecialchars($row[2],ENT_QUOTES); ?>' size=\"100\" maxlength=\"500\"></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' ><font face='verdana, arial, helvetica' size='2' align='center'>\n" +
            "\t\t<a href=edit_authors.php?id=<?php echo urlencode(htmlspecialchars($row[0],ENT_QUOTES)); ?>>Edit authors</a>\n" +
            "\n" +
            "\t\t</font></td> <td bgcolor='#f1f1f1' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<input READONLY type ='text' class='bginput' name='year' value='<?php\n" +
            "\t\t//start: List authors\n" +
            "\t\t$sql_text=sprintf(\"select name from authors where paper=%d\",$row[0]);\n" +
            "\t\t$count=1;\n" +
            "\t\t$authors = mysql_query($sql_text,$conn);\n" +
            "\t\t\n" +
            "\t\twhile ($row_authors =mysql_fetch_row($authors)) {\n" +
            "\t\t\tif ($count>1) echo \", \";\n" +
            "\t\t\techo htmlspecialchars($row_authors[0],ENT_QUOTES);\n" +
            "\t\t\t$count++;\n" +
            "\t\t}\n" +
            "\t\t//end: List authors\n" +
            "\t\t?>' size=\"100\" maxlength=\"100\"></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#ffffff' ><font face='verdana, arial, helvetica' size='2' align='center'>  conference\n" +
            "\t\t</font></td> <td bgcolor='#ffffff' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<input type ='text' class='bginput' name='conference' value='<?php echo htmlspecialchars($row[3],ENT_QUOTES); ?>' size=\"100\" maxlength=\"500\"></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#ffffff' ><font face='verdana, arial, helvetica' size='2' align='center'>  year\n" +
            "\t\t</font></td> <td bgcolor='#ffffff' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<input type ='text' class='bginput' name='year' value='<?php echo htmlspecialchars($row[4],ENT_QUOTES); ?>' size=\"6\" maxlength=\"4\"></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' ><font face='verdana, arial, helvetica' size='2' align='center'>  resume_por\n" +
            "\t\t</font></td> <td bgcolor='#f1f1f1' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<textarea name='resume_por' rows='14' cols='100' maxlength='250'><?php echo htmlspecialchars($row[5],ENT_QUOTES); ?></textarea></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' ><font face='verdana, arial, helvetica' size='2' align='center'>  relevance\n" +
            "\t\t</font></td> <td bgcolor='#f1f1f1' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<input type ='text' class='bginput' name='relevance' value='<?php echo htmlspecialchars($row[7],ENT_QUOTES); ?>' size=\"1\" maxlength=\"2\"></font></td></tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#ffffff' ><font face='verdana, arial, helvetica' size='2' align='center'>  area\n" +
            "\t\t</font></td> <td bgcolor='#ffffff' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<?php\n" +
            "\t\t//List areas\n" +
            "\t\t$sql_text=\"select id,name from areas\";\n" +
            "\t\t$areas = mysql_query($sql_text,$conn);\n" +
            "\t\t\n" +
            "\t\techo \" <select name='area'>\";\n" +
            "\t\twhile ($row_areas =mysql_fetch_row($areas)) {\n" +
            "\t\t\tif($row_areas[0]==$row[8])\n" +
            "\t\t\techo \"<option value=\\\"\".htmlspecialchars($row_areas[0],ENT_QUOTES).\"\\\" selected>\".htmlspecialchars($row_areas[1],ENT_QUOTES).\"</option>\";\n" +
            "\t\t\telse\n" +
            "\t\t\techo \"<option value=\\\"\".htmlspecialchars($row_areas[0],ENT_QUOTES).\"\\\">\".htmlspecialchars($row_areas[1],ENT_QUOTES).\"</option>\";\n" +
            "\t\t}\n" +
            "\t\techo \"</select></font></td></tr>\";\n" +
            "\t\t?>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' ><font face='verdana, arial, helvetica' size='2' align='center'>  type\n" +
            "\t\t</font></td> <td bgcolor='#f1f1f1' align='center'><font face='verdana, arial, helvetica' size='2' >\n" +
            "\t\t<?php\n" +
            "\t\t//List types\n" +
            "\t\t$sql_text=\"select id,name from types\";\n" +
            "\t\t$types = mysql_query($sql_text,$conn);\n" +
            "\t\t\n" +
            "\t\techo \" <select name='type'>\";\n" +
            "\t\twhile ($row_types =mysql_fetch_row($types)) {\n" +
            "\t\t\tif($row_types[0]==htmlspecialchars($row[9]))\n" +
            "\t\t\techo \"<option value=\\\"\".htmlspecialchars($row_types[0],ENT_QUOTES).\"\\\" selected>\".htmlspecialchars($row_types[1],ENT_QUOTES).\"</option>\";\n" +
            "\t\t\telse\n" +
            "\t\t\techo \"<option value=\\\"\".htmlspecialchars($row_types[0],ENT_QUOTES).\"\\\">\".htmlspecialchars($row_types[1],ENT_QUOTES).\"</option>\";\n" +
            "\t\t}\n" +
            "\t\techo \"</select></font></td></tr>\";\n" +
            "\t\t?>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' colspan='2' align='center'><font face='verdana, arial, helvetica' size='2' align='center'>\n" +
            "\t\t<input type='submit' name='submit_papers_row' value='Update'>\n" +
            "\t\t<input type='reset' value='Reset'>\n" +
            "\t\t</font></td> </tr>\n" +
            "\n" +
            "\t\t<tr> <td bgcolor='#f1f1f1' colspan='2' align='center'><font face='verdana, arial, helvetica' size='2' align='center'>\n" +
            "\t\t</font></td> </tr>\n" +
            "\n" +
            "\t\t</table></center></form>\n" +
            "\t\t<?php\n" +
            "\n" +
            "\t\t?>\n" +
            "\t\t<!-- The data encoding type, enctype, MUST be specified as below -->\n" +
            "\t\t<form enctype=\"multipart/form-data\" action=\"uploader.php\" method=\"POST\">\n" +
            "\t\t<!-- Name of input element determines name in $_FILES array -->\n" +
            "\t\tSend this file: <input name=\"userfile\" type=\"file\" />\n" +
            "\t\t<input type=\"submit\" value=\"Send File\" />\n" +
            "\t\t</form>\n" +
            "\t\t<?php\n" +
            "\t\t// Free the resources associated with the result set\n" +
            "\t\t// This is done automatically at the end of the script\n" +
            "\t\tmysql_close($conn);\n" +
            "\t}\n" +
            "}\n" +
            "else\n" +
            "{\n" +
            "\techo \"<br><p align=center><b>Sorry, but you are not alowed to upload files</b></p><br>\\n\";\n" +
            "}\n" +
            "?>\n" +
            "<br>\n" +
            "\n" +
            "<br><a href=\"logout.php\">Log out</a>\n" +
            "<br><a href=\"index.php\">home page</a><br>\n" +
            "<a href=\"insert_paper.php\">Insert paper</a><br>\n" +
            "<a href=\"show_papers.php\">Show papers</a><br>\n" +
            "<a href=\"javascript:history.back()\">Back</a>\n" +
            "</body>\n" +
            "</html>";




    @Override
    public void initialize(final URL location, final ResourceBundle resources) {

        //Set Text On Regex TextField
        regexTextField.setText(DEFAULT_REGEX);

        //Set Initial Text On Status Label
        final String DEFAULT_LABEL = "Please open a PHP file to analyze.";
        statusLabel.setText(DEFAULT_LABEL);

        // Get all values to populate on Regex Table
        getTableValues();

        //Open PHP File
        openPHPFile();

        //Watch File
        watchFile();

        analysingButton.setOnAction(event -> {

            //Clear previous data from table
            regexData.clear();

            Matcher existMatch = null;
            Pattern p;
            int existMatchStart;
            int existMatchEnd;

            try {
                if (caseSensitiveCheckBox.isSelected()) {
                    p = Pattern.compile(DEFAULT_REGEX);
                } else {
                    p = Pattern.compile(DEFAULT_REGEX, Pattern.CASE_INSENSITIVE);
                }

                existMatch = p.matcher(phpTest);

                jTextArea.append(phpTest);


                while (existMatch.find()) {

                    existMatchStart = existMatch.start();
                    existMatchEnd = existMatch.end();

                    addRegexResult(existMatch, existMatchStart, existMatchEnd);

                }
                exportButton.setDisable(false);
            } catch (Exception e) {
                e.printStackTrace();
            }
            if (existMatch != null) {
                existMatch.reset();
            }
        });


        exportButton.setOnAction(event -> {

            try {
                handleFiles.saveRegexFile(regexData);
            } catch (FileNotFoundException e) {
                e.printStackTrace();
            }

        });


    }

    private void addRegexResult(Matcher existMatch, int existMatchStart, int existMatchEnd) throws BadLocationException {
        regexData.add(new RegexTable(
                Integer.toString(existMatchStart),
                Integer.toString(existMatchEnd),
                Integer.toString(jTextArea.getLineOfOffset(existMatchStart) + 1),
                Integer.toString(existMatchStart - jTextArea.getLineStartOffset(jTextArea.getLineOfOffset(existMatchStart)) + 1),
                existMatch.group())
        );
    }

    private void getTableValues() {
        startColumn.setCellValueFactory(cellData -> cellData.getValue().getStartProperty());
        endColumn.setCellValueFactory(cellData -> cellData.getValue().getEndProperty());
        lineColumn.setCellValueFactory(cellData -> cellData.getValue().getLineProperty());
        columnColumn.setCellValueFactory(cellData -> cellData.getValue().getColumnProperty());
        resultColumn.setCellValueFactory(cellData -> cellData.getValue().getResultProperty());
        regexTable.setItems(regexData);
    }

    private void watchFile() {
        watchFileButton.setOnAction(WatchFileButtonEvent -> {
            try {
                final FXMLLoader fxmlLoader = new FXMLLoader(getClass().getResource("/utilities/filewatcher/FileWatcherView.fxml"));
                final Parent encodeDecodeTool = fxmlLoader.load();
                final Stage stage = new Stage();
                stage.setTitle("Remove this bar");
                stage.setResizable(false);
                stage.setScene(new Scene(encodeDecodeTool));
                final FileWatcherController controller = new FileWatcherController();
                controller.initData("teste", "teste");
                stage.show();
            } catch (Exception e) {
                log.fine(e.getMessage());
            }
        });
    }

    private void openPHPFile() {
        openFileButton.setOnAction(OpenFileButtonEvent -> {
            final File file = handleFiles.openFileDialog("PHP files (*.php)","*.php","Open PHP File");
            if (file != null) {

                //Set Localization of Open File
                fileLocationTextField.setText(file.getAbsolutePath());

                //Set Status with the name of open file
                statusLabel.setText("Current PHP file -> " + file.getName());

                //Activate Visual Elements
                caseSensitiveCheckBox.setDisable(false);
                analysingButton.setDisable(false);
                watchFileButton.setDisable(false);
            }
        });
    }
}
